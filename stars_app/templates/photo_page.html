{% extends 'base.html' %}

{% block content %}

<div class="photo-details">
    <h2>{{photo.title}}</h2>
    <!-- <p>{{photo.date}}</p> -->
    <p class="photo-explanation">{{photo.explanation}}</p>
    <p id='like'>Total likes: {{ likes }}</p>
    <p>Total comments: {{comments}} </p>
</div>

<div class="photo-container">
    <img src="{{photo.url}}" alt="{{photo.title}}">
</div>

<section>
    <a href="{% url 'add_comment' pk=photo.pk %}">Comment</a>
    <a href="{% url 'create_post' pk=photo.pk %}">I feel inspired</a>
</section>

<a class='like' >Like</a>

<script type="text/javascript">
const onSuccess = (response)=>{
    console.log(response.data);
    text = "Total likes: " + response.data.likes
    $('#like').text(text);
}

const onError = (err1, err2, err3)=>{
    console.log({err3});
}

 $(function () {
        $('.like').on('click', function () {
            $.ajax({
                method: "POST",
                url: 'api/v1/photo/{{photo.pk}}/add_like',
                success: onSuccess,
                error: onError,
            })
        });
    });

</script>
   


<section>
    <h3>Comments</h3>
    {% if photo.photocomments_photo.all %}
        {% for comment in photo.photocomments_photo.all %}
        <p class=comment>
            {{comment.user}}: 
            {{comment.body}}
            <br>
            {% if comment.user == user %}
            <a href="{% url 'edit_comment' pk=photo.pk comment_pk=comment.pk %}">Edit</a>
            <a href="{% url 'delete_comment' pk=photo.pk comment_pk=comment.pk %}">Delete</a>
            {% endif %}
        </p>
        

        {% endfor %}
    {% else %}
        <li class=comment>
            No Comments yet...
        </li>

    {% endif %}
</section>

{% endblock %}