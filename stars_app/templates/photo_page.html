{% extends 'base.html' %}

{% block content %}

<div class="photo-details">
    <h2>{{photo.title}}</h2>
    <!-- <p>{{photo.date}}</p> -->
    <p class="photo-explanation">{{photo.explanation}}</p>
    <div class="stat-info">
            <button class="toggle-icon {{checked}}" title="❤ Toggle Like!"></button>
            <span class="total-likes">{{ likes }}</span>
            <i class="fa fa-comment-o"></i>
            <span class="total-comments">{{comments}}</span>
        </div>
</div>

<div class="photo-container photo-page">
    <img src="{{photo.url}}" alt="{{photo.title}}">
</div>


<div class="rainbow">
    Rainbow border
</div>

<section>
    <a href="{% url 'add_comment' pk=photo.pk %}">Comment</a>
    <a href="{% url 'create_post' pk=photo.pk %}">I feel inspired</a>
</section>

<!-- Comment -->
<section class='add-comment'>
    <input class="comment-body" type="text"/>
</section>

<script type="text/javascript">
const onSuccess = (response)=>{
    console.log(response.data);
    $('.total-likes').text(response.data.likes);
}

const onError = (err1, err2, err3)=>{console.log({err3});}

$(function () {
    $('.toggle-icon').on('click', function () {
        $.ajax({
            method: "POST",
            url: 'api/v1/photo/{{photo.pk}}/add_like',
            success: onSuccess,
            error: onError,
        })
    });
});

// Listen to Like button
$('.toggle-icon').click(function(){
  $(this).toggleClass('-checked');
});

</script>
   


<section class="comments-block">
    <h3>Comments</h3>
    {% if photo.photocomments_photo.all %}
        {% for comment in photo.photocomments_photo.all %}
        <p class=comment>
            {{comment.user}}: 
            {{comment.body}}
            <br>
            {% if comment.user == user %}
            <a href="{% url 'edit_comment' pk=photo.pk comment_pk=comment.pk %}">Edit</a>
            <a href="{% url 'delete_comment' pk=photo.pk comment_pk=comment.pk %}">Delete</a>
            {% endif %}
        </p>
        

        {% endfor %}
    {% else %}
        <li class=comment>
            No Comments yet...
        </li>

    {% endif %}
</section>

{% endblock %}